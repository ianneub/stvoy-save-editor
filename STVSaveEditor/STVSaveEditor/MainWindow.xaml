<Window x:Class="STVSaveEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:STVSaveEditor.ViewModels"
        Title="STV: Across the Unknown Save Editor"
        Width="1000" Height="750"
        WindowStartupLocation="CenterScreen"
        Background="Black"
        WindowStyle="None"
        AllowsTransparency="True">
    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>
    <Window.Resources>
        <!-- LCARS Palette -->
        <SolidColorBrush x:Key="LcarsOrange" Color="#FFFF9900"/>
        <SolidColorBrush x:Key="LcarsYellow" Color="#FFFFCC66"/>
        <SolidColorBrush x:Key="LcarsBlue" Color="#FF99CCFF"/>
        <SolidColorBrush x:Key="LcarsPurple" Color="#FFCC99CC"/>
        <SolidColorBrush x:Key="LcarsPeach" Color="#FFFFCC99"/>
        <SolidColorBrush x:Key="LcarsPink" Color="#FFFF99CC"/>
        <SolidColorBrush x:Key="LcarsText" Color="#FFCCCCFF"/>

        <vm:FilePathToNameConverter x:Key="FileNameConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <Style x:Key="LcarsLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource LcarsOrange}"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontFamily" Value="Arial Narrow"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="LcarsButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource LcarsOrange}"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontFamily" Value="Arial Narrow"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" CornerRadius="12"
                                TextElement.FontWeight="Bold" TextElement.FontFamily="{TemplateBinding FontFamily}" 
                                TextElement.FontSize="{TemplateBinding FontSize}" TextElement.Foreground="{TemplateBinding Foreground}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Opacity" Value="0.8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="LcarsInput" TargetType="TextBox">
            <Setter Property="Background" Value="#111111"/>
            <Setter Property="Foreground" Value="{StaticResource LcarsText}"/>
            <Setter Property="BorderBrush" Value="{StaticResource LcarsBlue}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="CaretBrush" Value="White"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="FontFamily" Value="Consolas"/>
        </Style>

        <Style TargetType="ProgressBar">
            <Setter Property="Background" Value="#222222"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Border Background="{TemplateBinding Background}" CornerRadius="0">
                            <Grid>
                                <Border x:Name="PART_Track"/>
                                <Border x:Name="PART_Indicator" Background="{TemplateBinding Foreground}" HorizontalAlignment="Left"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Expander">
            <Setter Property="Foreground" Value="{StaticResource LcarsText}"/>
            <Setter Property="FontFamily" Value="Arial Narrow"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition x:Name="ContentRow" Height="0"/>
                            </Grid.RowDefinitions>
                            <ToggleButton x:Name="HeaderSite" 
                                          IsChecked="{Binding IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Cursor="Hand"
                                          HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="Black">
                                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                                <ContentPresenter ContentSource="Header" RecognizesAccessKey="True" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
                            </ToggleButton>
                            <ContentPresenter x:Name="ExpandSite" Grid.Row="1" Visibility="Collapsed" Margin="0,10,0,0"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ContentRow" Property="Height" Value="*"/>
                                <Setter TargetName="ExpandSite" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" RenderOptions.ClearTypeHint="Enabled">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="150"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LCARS Left Spine -->
        <Grid Grid.Column="0" Background="Black">
            <Grid.RowDefinitions>
                <RowDefinition Height="120"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="60"/>
            </Grid.RowDefinitions>

            <!-- Top Elbow -->
            <Border Grid.Row="0" Background="{StaticResource LcarsPurple}" CornerRadius="0,60,0,0" Margin="0,0,10,5"/>
            
            <StackPanel Grid.Row="1">
                <Border Background="{StaticResource LcarsOrange}" Height="40" CornerRadius="0" Margin="0,0,10,5">
                    <TextBlock Text="SYSTEM" Foreground="Black" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,15,0"/>
                </Border>
                <Border Background="{StaticResource LcarsYellow}" Height="40" CornerRadius="0" Margin="0,0,10,5">
                    <TextBlock Text="RESOURCES" Foreground="Black" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,15,0"/>
                </Border>
                <Border Background="{StaticResource LcarsBlue}" Height="80" CornerRadius="0" Margin="0,0,10,5">
                    <TextBlock Text="LCARS 402" Foreground="Black" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,15,5"/>
                </Border>
            </StackPanel>

            <!-- Spine Extension -->
            <Border Grid.Row="2" Background="{StaticResource LcarsYellow}" Margin="0,0,10,5"/>

            <!-- Bottom Elbow Placeholder -->
            <Border Grid.Row="3" Background="{StaticResource LcarsOrange}" CornerRadius="0,0,60,0" Margin="0,0,10,0">
                <TextBlock Text="04-62" Foreground="Black" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,5,15,0"/>
            </Border>
        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="60"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="60"/>
            </Grid.RowDefinitions>

            <!-- Title Bar / Header -->
            <Border x:Name="TitleBar" Grid.Row="0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown" Background="Black">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" Margin="10,0,0,10">
                        <TextBlock Text="STV: ACROSS THE UNKNOWN" Foreground="{StaticResource LcarsPeach}" FontSize="24" FontWeight="Bold" Margin="0,0,20,0"/>
                        <TextBlock Text="DATA RETRIEVAL SYSTEM 01" Foreground="{StaticResource LcarsPink}" FontSize="14" FontWeight="Bold" VerticalAlignment="Bottom" Margin="0,0,0,4"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,5,5,0">
                        <Button Style="{StaticResource LcarsButton}" Content="—" Width="50" Height="25" Background="{StaticResource LcarsBlue}" Click="Minimize_Click" Margin="0,0,5,0"/>
                        <Button Style="{StaticResource LcarsButton}" Content="▢" Width="50" Height="25" Background="{StaticResource LcarsYellow}" Click="Maximize_Click" Margin="0,0,5,0"/>
                        <Button Style="{StaticResource LcarsButton}" Content="X" Width="40" Height="25" Background="#FFFF3333" Click="Close_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Content -->
            <ScrollViewer Grid.Row="1" Margin="20,10,20,10" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- File Select -->
                    <Border Background="{StaticResource LcarsPurple}" CornerRadius="20" Padding="15,5" Margin="0,0,0,20">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="SAVE FILE" Foreground="Black" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,15,0"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding SaveFiles}" SelectedItem="{Binding SelectedFile}" Background="Black" BorderThickness="0">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Converter={StaticResource FileNameConverter}}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Grid.Column="2" Content="BROWSE" Style="{StaticResource LcarsButton}" Background="{StaticResource LcarsYellow}" Click="BrowseButton_Click" Margin="10,0,0,0"/>
                        </Grid>
                    </Border>

                    <!-- Hull Section -->
                    <TextBlock Text="01 - STRUCTURAL INTEGRITY" Foreground="{StaticResource LcarsOrange}" FontWeight="Bold" FontSize="18" Margin="0,10,0,10"/>
                    <Border BorderBrush="{StaticResource LcarsBlue}" BorderThickness="0,0,0,2" Margin="0,0,0,10"/>
                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="CURRENT HULL" Style="{StaticResource LcarsLabel}" Margin="0,0,10,0"/>
                        <TextBox Grid.Column="1" Style="{StaticResource LcarsInput}" Text="{Binding HullIntegrity, UpdateSourceTrigger=PropertyChanged}"/>
                        <ProgressBar Grid.Column="2" Value="{Binding HullIntegrity}" Maximum="{Binding HullMax}" Foreground="{StaticResource LcarsBlue}" Margin="20,0"/>
                        <TextBlock Grid.Column="3" Text="MAX HULL" Style="{StaticResource LcarsLabel}"/>
                        <TextBox Grid.Column="4" Style="{StaticResource LcarsInput}" IsReadOnly="True" Opacity="0.5" Text="{Binding HullMax, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <!-- Morale Section -->
                    <TextBlock Text="02 - CREW MORALE" Foreground="{StaticResource LcarsOrange}" FontWeight="Bold" FontSize="18" Margin="0,10,0,10"/>
                    <Border BorderBrush="{StaticResource LcarsPurple}" BorderThickness="0,0,0,2" Margin="0,0,0,10"/>
                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="CURRENT MORALE" Style="{StaticResource LcarsLabel}"/>
                        <TextBox Grid.Column="1" Style="{StaticResource LcarsInput}" Text="{Binding CurrentMorale, UpdateSourceTrigger=PropertyChanged}"/>
                        <ProgressBar Grid.Column="2" Value="{Binding CurrentMorale}" Maximum="{Binding MoraleMax}" Foreground="{StaticResource LcarsPurple}" Margin="20,0"/>
                        <TextBlock Grid.Column="3" Text="MAX MORALE" Style="{StaticResource LcarsLabel}"/>
                        <TextBox Grid.Column="4" Style="{StaticResource LcarsInput}" IsReadOnly="True" Opacity="0.5" Text="{Binding MoraleMax}"/>
                    </Grid>

                    <!-- Crew/Resources -->
                    <TextBlock Text="03 - BASE RESOURCES" Foreground="{StaticResource LcarsOrange}" FontWeight="Bold" FontSize="18" Margin="0,10,0,10"/>
                    <Border BorderBrush="{StaticResource LcarsYellow}" BorderThickness="0,0,0,2" Margin="0,0,0,10"/>
                    <ItemsControl ItemsSource="{Binding BaseResources}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Width="220" Margin="5">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding DisplayName}" Style="{StaticResource LcarsLabel}"/>
                                            <TextBlock Text="ⓘ" Foreground="{StaticResource LcarsBlue}" Visibility="{Binding HasToolTip, Converter={StaticResource BooleanToVisibilityConverter}}" VerticalAlignment="Center">
                                                <TextBlock.ToolTip>
                                                    <ToolTip>
                                                        <TextBlock Text="{Binding ToolTipText}" TextWrapping="Wrap" MaxWidth="250"/>
                                                    </ToolTip>
                                                </TextBlock.ToolTip>
                                            </TextBlock>
                                        </StackPanel>
                                        <TextBox Grid.Column="1" Style="{StaticResource LcarsInput}" Width="70" Text="{Binding NewQuantity, UpdateSourceTrigger=PropertyChanged}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- SECTION 04 - MISCELLANEOUS (header outside Expander for consistent bold rendering) -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,10" Cursor="Hand" MouseLeftButtonDown="MiscHeader_Click">
                        <TextBlock Text="04 - MISCELLANEOUS DATA" Foreground="{StaticResource LcarsOrange}" FontWeight="Bold" FontSize="18"/>
                        <Border Background="Transparent" ToolTipService.InitialShowDelay="100" Margin="10,0,5,0" VerticalAlignment="Center">
                            <Border.ToolTip>
                                <ToolTip>
                                    <TextBlock Text="WARNING: THIS SECTION INCLUDES ITEMS SUCH AS MISSION OBJECTIVES. BE CAREFUL WHEN EDITING." 
                                               TextWrapping="Wrap" MaxWidth="250"/>
                                </ToolTip>
                            </Border.ToolTip>
                            <TextBlock Text="ⓘ" Foreground="{StaticResource LcarsBlue}" FontSize="16" FontWeight="Bold"/>
                        </Border>
                        <Path x:Name="MiscArrow" Fill="{StaticResource LcarsOrange}" Data="M 0 0 L 4 4 L 8 0 Z" VerticalAlignment="Center" Margin="5,0,0,0"/>
                    </StackPanel>
                    <Border BorderBrush="{StaticResource LcarsPeach}" BorderThickness="0,0,0,2" Margin="0,0,0,10"/>
                    <Expander x:Name="MiscExpander" IsExpanded="False" Header="" Visibility="Collapsed">
                        <Expander.Style>
                            <Style TargetType="Expander" BasedOn="{StaticResource {x:Type Expander}}"/>
                        </Expander.Style>
                    </Expander>
                    <ItemsControl x:Name="MiscItems" ItemsSource="{Binding Items}" Visibility="Collapsed">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Width="350" Margin="5">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="{Binding DisplayName}" Style="{StaticResource LcarsLabel}"/>
                                        <TextBox Grid.Column="1" Style="{StaticResource LcarsInput}" Width="80" Text="{Binding NewQuantity, UpdateSourceTrigger=PropertyChanged}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>

            <!-- Bottom Controls -->
            <Border Grid.Row="2" Background="Black" BorderBrush="{StaticResource LcarsOrange}" BorderThickness="0,2,0,0">
                <Grid Margin="10">
                    <StackPanel Orientation="Horizontal">
                        <Button Content="COMMIT CHANGES" Style="{StaticResource LcarsButton}" FontWeight="Bold" Command="{Binding SaveCommand}" Width="150" Height="35" Margin="0,0,10,0"/>
                        <Button Content="RELOAD" Style="{StaticResource LcarsButton}" FontWeight="Bold" Command="{Binding ReloadCommand}" Width="100" Height="35" Background="{StaticResource LcarsBlue}"/>
                    </StackPanel>
                    <TextBlock Text="{Binding StatusMessage}" Foreground="{StaticResource LcarsText}" HorizontalAlignment="Right" VerticalAlignment="Center" FontSize="16" FontWeight="Bold"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>
